@model LookupViewModel

<div x-data="{
        showGrid: false,
        searchTerm: '',
        lastValidTerm: '',
        validate() {
            if (this.searchTerm !== this.lastValidTerm) {
                this.searchTerm = '';
                this.lastValidTerm = '';
                $dispatch('lookupitemselected', null);
            }
        }
     }"
     x-init="$el.closest('dialog')?.addEventListener('cancel', (e)=>
        {
            if (showGrid) {
                e.preventDefault();
                showGrid = false;
            }
        });"
     x-on:lookupitemselected.window="showGrid = false"
     class="w-full space-y-2">
    <div>
        <label class="block text-sm font-medium text-slate-700 dark:text-white">@Model.Label</label>
        <input type="text"
               name="searchQuery"
               x-model="searchTerm"
               hx-post="?handler=@Model.HandlerName"
               hx-trigger="keyup changed delay:500ms, keydown[key=='Enter']"
               hx-target="#lookup-results-@Model.Id"
               x-on:htmx:after-request="showGrid = true"
               x-on:keydown.enter.prevent=""
               x-on:blur="setTimeout(() => validate(), 200)"
               class="text-sm w-full rounded-lg border border-slate-200 dark:border-emerald-600 bg-slate-50 dark:bg-emerald-700 text-slate-800 dark:text-white px-2 py-1 focus:outline-none focus:ring-2 focus:ring-field-green-500">
    </div>
    <div id="lookup-results-@Model.Id"
         x-show="showGrid"
         x-on:click.away="showGrid = false"
         x-transition
         class="absolute left-0 right-0 z-[100] mt-1 bg-white dark:bg-emerald-800 rounded-lg shadow-xl border border-slate-200 dark:border-emerald-700 overflow-hidden"
         style="display: none;">
    </div>
</div>