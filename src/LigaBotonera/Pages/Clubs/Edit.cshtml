@page
@model LigaBotonera.Pages.Clubs.Edit
@{
    Layout = null;
    ViewData["Title"] = "Edit";
}
<div class="mb-6">
    <h2 class="text-xl font-bold text-slate-800 dark:text-white ">
        Editar Clube
    </h2>
    <p class="text-xs font-bold text-slate-600 dark:text-emerald-700">
        Clubes > Editar
    </p>
</div>

<form method="post" id="editClubForm" asp-page="Edit"
      class="bg-white dark:bg-emerald-800 rounded-xl p-4 border border-slate-200 dark:border-emerald-700 shadow-sm space-y-6">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <input type="hidden" asp-for="Data.Id" />
    <div>
        <h3 class="text-sm font-semibold text-slate-800 dark:text-emerald-300 mb-2">
            Dados
        </h3>
        <div class="grid grid-cols-1 gap-3">
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-white" asp-for="Data.Name"></label>
                <input type="text"
                       class="text-sm w-full rounded-lg border border-slate-200 dark:border-emerald-600 bg-slate-50 dark:bg-emerald-700 text-slate-800 dark:text-white px-2 py-1 focus:outline-none focus:ring-2 focus:ring-field-green-500"
                       asp-for="Data.Name">
                <span asp-validation-for="Data.Name" class="text-danger"></span>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-white" asp-for="Data.FullName"></label>
                <input type="text"
                       class="text-sm w-full rounded-lg border border-slate-200 dark:border-emerald-600 bg-slate-50 dark:bg-emerald-700 text-slate-800 dark:text-white px-2 py-1 focus:outline-none focus:ring-2 focus:ring-field-green-500"
                       asp-for="Data.FullName">
                <span asp-validation-for="Data.FullName" class="text-danger"></span>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-white" asp-for="Data.City"></label>
                <input type="text"
                       class="text-sm w-full rounded-lg border border-slate-200 dark:border-emerald-600 bg-slate-50 dark:bg-emerald-700 text-slate-800 dark:text-white px-2 py-1 focus:outline-none focus:ring-2 focus:ring-field-green-500"
                       asp-for="Data.City">
                <span asp-validation-for="Data.City" class="text-danger"></span>
            </div>
            <div class="w-1/8">
                <label class="block text-sm font-medium text-slate-700 dark:text-white" asp-for="Data.State"></label>
                <select class="text-sm w-full rounded-lg border border-slate-200 dark:border-emerald-600 bg-white dark:bg-emerald-700 text-slate-800 dark:text-white px-2 py-1 focus:outline-none focus:ring-2 focus:ring-field-green-500"
                        asp-for="Data.State">
                    <option value=""></option>
                    <option value="BA">Bahia</option>
                    <option value="MG">Minas Gerais</option>
                    <option value="RJ">Rio de Janeiro</option>
                    <option value="RS">Rio Grande do Sul</option>
                    <option value="SP">São Paulo</option>
                </select>
                <span asp-validation-for="Data.State" class="text-danger"></span>
            </div>
        </div>
    </div>
    <div class="flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-emerald-700">
        <button type="button"
                onclick="closeModalContainer()"
                class="px-4 py-2 rounded-lg border border-slate-300 dark:border-emerald-600 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-emerald-700">
            Cancelar
        </button>
        <button type="button" id="deleteClubButton"
                class="px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors">
            Excluir
        </button>
        <button type="submit"
                class="px-6 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors">
            Salvar
        </button>
    </div>
</form>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        document.getElementById('editClubForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e.target;
            fetch(form.action, {
                method: form.method,
                body: new FormData(form),
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (response.redirected) {
                    closeModalContainer();
                    window.location.href = response.url;
                } else if (response.ok) {
                    closeModalContainer();
                    location.reload();
                } else {
                    response.text().then(html => {
                        document.getElementById('modal-container-content').innerHTML = html;
                    });
                }
            })
            .catch(error => {
                console.error('Error submitting form:', error);
                alert('An error occurred while saving the club.');
            });
        });

        document.getElementById('deleteClubButton').addEventListener('click', function(e) {
            e.preventDefault();
            showMessageModal({
                title: 'Confirmação de Exclusão',
                message: 'Tem certeza que deseja excluir este clube?',
                type: 'Question',
                confirmText: 'Excluir',
                cancelText: 'Cancelar',
                onConfirm: () => {
                    fetch('/Clubs/Edit?handler=Delete&id=@Model.Data.Id', {
                        method: 'POST',
                        headers: {
                            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value,
                            'X-Requested-with': 'XMLHttpRequest'
                        }
                    })
                    .then(response => {
                        if (response.ok) {
                            closeModalContainer();
                            location.reload();
                        } else {
                            alert('Erro ao excluir o clube.');
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao excluir:', error);
                        alert('Erro ao excluir o clube.');
                    });
                }
            });
        });
    </script>
}
